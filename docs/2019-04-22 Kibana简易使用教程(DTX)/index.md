# Kibana简易使用教程(DTX)

---

### 简介

Kibana 是一个基于浏览器页面的ElasticSearch 前端展示工具，也是一个开源和免费的工具。Kibana可以为 Logstash 和 ElasticSearch 提供日志分析的友好 Web 界面，可以帮助您汇总、分析和搜索重要日志数据。

### 【发现】菜单

![img](images/1556090495723.png)

该菜单主要用于对日志数据进行搜索展示。常见操作流程如下：

1、在【发现】菜单下，点击【新建】按钮，新建查询。

![img](images/1556090779233.png)

2、下拉选择索引，用于选择某个应用的日志（比如Web、门户、DTX服务、工作流服务、微信端等等）。

![img](images/1556091307901.png)

附：索引情况

* `logstash-dtx-portal-access-*`：门户访问日志
* `logstash-dtx-portal-app-*`：门户应用日志
* `logstash-dtx-service-app-*`：DTX服务日志
* `logstash-dtx-web-access-*`：Web访问日志
* `logstash-dtx-web-app-*`：Web应用日志
* `logstash-dtx-wechatapi-app-*`：微信端日志
* `logstash-dtx-wechatapi-oa-app-*`：微信端OA日志
* `logstash-dtx-workflow-app-*`：工作流服务日志

3、如需查找日志，可输入关键字进行过滤（如查找超级管理员gdcn_admin相关的数据）。

![img](images/1556092038839.png)

4、自定义结果表格数据列。【可用字段】--【添加】

![img](images/1556092182616.png)

![img](images/1556092298861.png)

> 注：一般添加应用标识（fields.app_id）和日志内容（message）两列即可，如有特殊需求可自行定义。表格第一列时间为日志的采集时间，与日志生成时间并不等价，日志生成时间参考message列里面的时间为准。

5、保存查询。

![img](images/1556092850848.png)

6、对于已保存的查询，可以重新被打开、修改、再保存。

![img](images/1556093064525.png)

7、打开某个查询，可以设置时间范围，查看该时间段内的日志数据，并且可以设置自动刷新。

![img](images/1556093187437.png)

![img](images/1556093304093.png)

![img](images/1556093356333.png)

### 【可视化】菜单

![img](images/1556093575651.png)

该菜单主要以图表的形式展示日志数据。比如状态码统计、用户使用的操作系统和浏览器统计、高频来访IP统计等等。

下面以 DTX门户状态码统计 图表为例进行说明。

1、在【可视化】菜单下，点击添加按钮。

![img](images/1556093844715.png)

2、选择图表类型。（此处选择饼状图）

![img](images/1556093971927.png)

3、选择图表数据的来源，可以是索引或者是我们建立并保存的查询。

![img](images/1556094078079.png)

> 附：选择索引的数据可理解为未经过滤的原生数据，从查询选择数据可理解为经过我们过滤处理后的数据。

4、设置图表参数，生成图表。

![img](images/1556094408132.png)

![img](images/1556094598039.png)

5、保存图表。

![img](images/1556094717054.png)

6、同理，可调节时间范围来查看图表，并设置自动刷新。

![img](images/1556094838255.png)

7、已保存的图表可在【可视化】菜单首页查看。打开图表，可重新编辑、保存。

![img](images/1556094940765.png)

> 附：关于Kibana创建图表的更多信息，参考[这里](https://shimo.im/docs/IhQBQxpVzagEPwCX/read)。

### 【仪表盘】菜单

![img](images/1556095130981.png)

仪表盘主要用于集中展示我们创建的多个查询或图表。比如，DTX 门户 和 Web 都有状态码统计图表，放到仪表盘能够更加直观地看到两者的异同，便于进一步的统计分析。

1、在【仪表盘】菜单下，点击新建仪表盘按钮。

![img](images/1556095791752.png)

2、往仪表盘添加查询或图表。

![img](images/1556095867508.png)

3、依次添加。

![img](images/1556096005151.png)

![img](images/1556096156622.png)

4、可拖拽图表调整位置，缩放图表调整大小。

![img](images/1556096110374.png)

5、调整完毕，保存。

![img](images/1556096634750.png)

![img](images/1556096693465.png)

### 示例：配置微信端公司领导错误日志视图

为了便于集中查看微信端公司领导的错误日志，配置此视图。

1、打开【发现】菜单，点击【新建】按钮建立新的查询，选择索引`logstash-dtx-wechatapi-app-*`对应微信端的日志。

![img](images/1556097126388.png)

2、在搜索框输入关键字，如`liaozhiwei`，搜索出某个用户的日志数据。

![img](images/1556097470008.png)

3、调整表格数据列。

![img](images/1556097532902.png)

4、保存查询。

![img](images/1556097645665.png)

5、重复以上1~4步骤，分别创建其它公司领导的查询。结果如下：

![img](images/1556098436727.png)

6、打开【仪表盘】菜单，新建仪表盘，添加查询。

![img](images/1556099060619.png)

![img](images/1556098634514.png)

7、调整。

![img](images/1556098902815.png)

8、保存仪表盘。

![img](images/1556098989099.png)

![img](images/1556099024527.png)



<br/><br/><br/>

---

